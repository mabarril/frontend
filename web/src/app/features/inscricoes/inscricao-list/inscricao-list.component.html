<div class="container">
    <div class="header">
        <h1>Inscrições</h1>
        <button mat-raised-button color="primary" routerLink="/inscricoes/nova">
            <mat-icon>add</mat-icon> Nova Inscrição
        </button>
    </div>

    <mat-card class="filter-section">
        <mat-card-content>
            <mat-form-field appearance="outline" style="width: 100%;">
                <mat-label>Selecione o Evento</mat-label>
                <mat-select [(ngModel)]="selectedEventoId" (selectionChange)="onEventoChange()">
                    <mat-option *ngFor="let evento of eventos" [value]="evento.id">
                        {{ evento.nome }} ({{ evento.data_inicio | date:'dd/MM/yyyy' }})
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </mat-card-content>
    </mat-card>

    <div class="mat-elevation-z2" *ngIf="selectedEventoId">
        <table mat-table [dataSource]="inscricoes">

            <!-- Casal Column -->
            <ng-container matColumnDef="casal">
                <th mat-header-cell *matHeaderCellDef> Casal </th>
                <td mat-cell *matCellDef="let inscricao">
                    <!-- Assuming expand is working or we fetch casal names. 
                If 'casal' property is populated: -->
                    <span *ngIf="inscricao.casal?.esposo?.nome_social && inscricao.casal?.esposa?.nome_social">
                        {{ inscricao.casal?.esposo?.nome_social }} e {{ inscricao.casal?.esposa?.nome_social }}
                    </span>
                    <span *ngIf="!inscricao.casal?.esposo">
                        Casal #{{ inscricao.casal_id }}
                    </span>
                </td>
            </ng-container>

            <!-- Tipo Column -->
            <ng-container matColumnDef="tipo">
                <th mat-header-cell *matHeaderCellDef> Tipo </th>
                <td mat-cell *matCellDef="let inscricao"> {{ inscricao.tipo_participante | titlecase }} </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef> Status </th>
                <td mat-cell *matCellDef="let inscricao"> {{ inscricao.status | titlecase }} </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="acoes">
                <th mat-header-cell *matHeaderCellDef> Ações </th>
                <td mat-cell *matCellDef="let inscricao">
                    <button mat-icon-button color="primary" [routerLink]="['/inscricoes', inscricao.id]"
                        class="action-button">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteInscricao(inscricao)" class="action-button">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">Nenhuma inscrição encontrada para este evento</td>
            </tr>
        </table>
    </div>
</div>